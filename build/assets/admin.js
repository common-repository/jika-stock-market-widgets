const baseUrl=isProduction?"https://www.jika.io/api":"https://www.jika.io/api/sandbox",createBasicAuth=(e,t)=>`Basic ${btoa(`${e}:${t}`)}`,createBearerAuth=()=>`Bearer ${my_ajax_obj.token}`,getAuthHeader=(e="bearer",...t)=>{let a;return a="bearer"===e?createBearerAuth:createBasicAuth,{Authorization:a(...t)}},fetchError=(e,t)=>{const a=new Error(e);return a.status=t,a},handleFetch=(e,t)=>fetch(`${baseUrl}${e}`,t).then((async e=>{const t=await e.json().catch((()=>({})));if(!e.ok)throw fetchError(t.message,e.status);return t.token&&(my_ajax_obj.token=t.token),t})),login=(e,t)=>handleFetch("/widget_user/tokens",{headers:getAuthHeader("basic",e,t)}),signup=(e,t,a)=>{const n=new URLSearchParams;return n.append("email",e),n.append("password",t),n.append("domain",a),n.append("platform","wp"),handleFetch("/widget_user/signup",{method:"POST",body:n})},contactUs=(e,t,a,n,r)=>handleFetch("/widget_user/contact_us",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,domain:t,company_profile:a,request_type:n,note:r,platform:"wp"})}),handleUploadTrademark=async e=>{const t=new FormData;return t.append("trademark",e),handleFetch("/widget_user/setup/logo",{method:"POST",headers:getAuthHeader("bearer"),body:t})},handleUpdateDomain=async e=>{const t=new FormData;return t.append("domain",e),handleFetch("/widget_user/setup/domain",{method:"POST",headers:{...getAuthHeader("bearer")},body:t})},handleSubscribe=(e,t,a)=>{const n={subscription:e,plan:t,period:a};return handleFetch("/payments/subscription",{method:"POST",headers:{...getAuthHeader("bearer"),"Content-Type":"application/json"},body:JSON.stringify(n)})},handleSubscriptionCancel=()=>handleFetch("/payments/subscription/cancel",{method:"POST",headers:getAuthHeader("bearer")}),getSubscriptionId=()=>handleFetch("/payments/subscription/id",{headers:getAuthHeader("bearer")}),createElementWithProps=(e,t)=>{const a=document.createElement(e);return Object.entries(t).forEach((([e,t])=>{a[e]=t})),a},createButton=(e,t="primary")=>(e.type||(e.type="button"),e.className?e.className+=" ":e.className="",e.className+=`button button-${t}`,createElementWithProps("button",e)),createSuccessNotice=(e,t)=>{const a=document.createElement("div");a.className="notice is-dismissible  updated";const n=document.createElement("p");n.textContent=t;const r=document.createElement("button");r.type="button",r.className="notice-dismiss",r.onclick=()=>e.parentElement.removeChild(a),a.append(n,r),e.parentElement.prepend(a)},ajaxPost=(e,t,a)=>{const{ajax_url:n,nonce:r}=my_ajax_obj;jQuery.post(n,{_ajax_nonce:r,action:e,...t},a)};let paypalButtons;const plansIds={production:{business:{monthly:"P-0UB63026V1306202YMW4QP7A",annually:"P-5ST91621FA5466136MW4QPPI"},enterprise:{monthly:"P-09775653JC2457618MW4QPBQ",annually:"P-8YS088838H4496913MW4QOWQ"}},development:{business:{monthly:"P-49N160356B894240YMWZDZOA",annually:"P-3H188263Y4467252NMWZD36Y"},enterprise:{monthly:"P-2MG263859C231894EMWZD4YA",annually:"P-51B16060SH6757511MWZD5FI"}}},planInputEl=jQuery("input#plan"),buttons=[{name:"free",label:"Free",subtitle:"All widgets, free to use forever.",price:{monthly:"$0",annually:"$0"},features:["Bug Fixes","Custom Branding (1 Domain)","500 Pageviews / month"]},{name:"business",label:"Business",subtitle:"More Pageviews, Priority Support.",price:{monthly:"$19.99",annually:"$11.99"},features:["All Free Features","Priority Support","5000 Pageviews / month"],popular:!0},{name:"enterprise",label:"Enterprise",subtitle:"Unlimited Pageviews, Multiple domains and feature requests.",price:{monthly:"$119.99",annually:"$71.99"},features:["All Business Features","Dedicated Account Manager","Multi-Language Options","Custom Branding (Multiple Domains)","Widget & Feature Requests","Unlimited Pageviews / month"]}];let planPeriod="annually";const togglePlanPeriod=()=>{planPeriod="monthly"===planPeriod?"annually":"monthly"},planPeriodEl=document.createElement("div");planPeriodEl.className="jika-widgets-plan-period";const monthlyLabel=document.createElement("h3");monthlyLabel.textContent="Monthly",planPeriodEl.append(monthlyLabel);const planPeriodToggle=document.createElement("button");planPeriodToggle.className="jika-widgets-plan-period-toggle toggled",planPeriodToggle.type="button",planPeriodEl.append(planPeriodToggle);const annuallyLabel=document.createElement("h3");annuallyLabel.textContent="Annually",planPeriodEl.append(annuallyLabel);const annuallyLabelSave=document.createElement("h3");let currentButton;annuallyLabelSave.textContent="Save 40%",annuallyLabelSave.style.background="#fe9431",planPeriodEl.append(annuallyLabelSave),jQuery(".jika-widges-plans").prepend(planPeriodEl),jQuery(".jika-widgets-plan-period-toggle").click((()=>{planPeriodToggle.classList.toggle("toggled"),togglePlanPeriod(),buttons.forEach((e=>{jQuery("#plan_"+e.name+" .jika-widgets-plan-price > h3").text(e.price[planPeriod]||e.price)}))}));const buttonsEl={};buttons.forEach((function(e){const{name:t,label:a,subtitle:n,price:r,features:s}=e,o=jQuery("#plan_"+t);buttonsEl[t]=o;const i=[],l=document.createElement("h2");l.className="jika-widgets-plan-label",l.textContent=a||"Â ",i.push(l);const u=document.createElement("div");u.className="jika-widgets-plan-price";const d=document.createElement("h3");if(d.textContent=r[planPeriod]||r,u.appendChild(d),"string"!=typeof r){const e=document.createElement("h4");e.textContent=" / Month",u.appendChild(e)}i.push(u);const c=document.createElement("h4");c.textContent=n,i.push(c);const p=document.createElement("ul");if(p.className="jika-widgets-plan-features",p.append(...s.map((e=>{const t=document.createElement("li"),a=document.createElement("span");return a.className="dashicons dashicons-yes",document.createElement("p").textContent=e,t.append(a,e),t}))),i.push(p),e.popular){const e=document.createElement("div");e.className="jika-widgets-plan-tag jika-widgets-plan-popular-tag";const t=document.createElement("span");t.className="dashicons dashicons-star-filled",e.append(t,"Popular"),i.push(e)}if(o.hasClass("jika-widgets-current")){currentButton=e;const t=document.createElement("div");t.className="jika-widgets-plan-tag jika-widgets-plan-current-tag",t.textContent="Current",i.push(t),currentButton.removeCurrentPlanTag=()=>jQuery(".jika-widgets-plan-current-tag").remove()}jQuery("#plan_"+t+" .jika-widgets-spinner").remove(),o.append(i),o.click((function(){if(buttons.filter((t=>t!==e)).forEach((e=>{buttonsEl[e.name].removeClass("jika-widgets-active")})),jQuery(".jika_widgets_paypal_buttons .button-danger").remove(),o.addClass("jika-widgets-active"),paypalButtons&&(paypalButtons.close(),paypalButtons=!1),o.hasClass("jika-widgets-current")||"plan_free"===o.attr("id")){if(!o.hasClass("jika-widgets-current")){const t=createButton({className:"jika-widgets-paypal-cancel-button",textContent:"Cancel Subscription"},"danger");t.addEventListener("click",(()=>{handleSubscriptionCancel().then((t=>{buttonsEl[currentButton.name].removeClass("jika-widgets-current"),currentButton.removeCurrentPlanTag(),delete currentButton.removeCurrentPlanTag,currentButton=e;const a=document.createElement("div");a.className="jika-widgets-plan-tag jika-widgets-plan-current-tag",a.textContent="Current",buttonsEl[currentButton.name].addClass("jika-widgets-current"),buttonsEl[currentButton.name].append(a),currentButton.removeCurrentPlanTag=()=>jQuery(".jika-widgets-plan-current-tag").remove(),ajaxPost("jika_widgets_after_paypal_subscription",{plan:t.plan,token:t.token},(function(e){buttons.forEach((e=>{e.name!==t.plan?buttonsEl[e.name].removeClass("jika-widgets-current"):buttonsEl[e.name].addClass("jika-widgets-current")})),jQuery(".jika_widgets_paypal_buttons .jika-widgets-paypal-cancel-button").remove()}))}))})),jQuery(".jika_widgets_paypal_buttons").append(t)}}else isProduction?window.paypal&&(paypalButtons=paypal.Buttons({style:{shape:"rect",label:"subscribe"},createSubscription(t,a){let n=a.subscription.create;return"free"!==currentButton.name&&(n=e=>getSubscriptionId().then((t=>a.subscription.revise(t.subscription_id,e)))),n({plan_id:plansIds[isProduction?"production":"development"][e.name][planPeriod]}).then((e=>e))},onApprove(t){handleSubscribe(t,e.name,planPeriod).then((t=>{buttonsEl[currentButton.name].removeClass("jika-widgets-current"),currentButton.removeCurrentPlanTag(),delete currentButton.removeCurrentPlanTag,currentButton=e;const a=document.createElement("div");a.className="jika-widgets-plan-tag jika-widgets-plan-current-tag",a.textContent="Current",buttonsEl[currentButton.name].addClass("jika-widgets-current"),buttonsEl[currentButton.name].append(a),currentButton.removeCurrentPlanTag=()=>jQuery(".jika-widgets-plan-current-tag").remove(),ajaxPost("jika_widgets_after_paypal_subscription",{plan:t.plan,token:t.token},(function(){buttons.forEach((e=>{e.name!==t.plan?buttonsEl[e.name].removeClass("jika-widgets-current"):buttonsEl[e.name].addClass("jika-widgets-current")})),paypalButtons.close()}))}))}}),paypalButtons.render(".jika_widgets_paypal_buttons")):(paypalButtons={element:createButton({className:"jika-widgets-sandbox-paypal-button",textContent:"Sandbox Paypal Subscription",style:"width: 100%; font-size: 24px; border-radius: 5px; padding: 5px 0;"}),close:()=>jQuery(".jika_widgets_paypal_buttons .jika-widgets-sandbox-paypal-button").remove()},paypalButtons.element.addEventListener("click",(()=>{let t=Promise.resolve();"free"!==currentButton.name&&(t=getSubscriptionId()),t.then((()=>{handleSubscribe({subscriptionID:"subscriptionID"},e.name,planPeriod).then((t=>{buttonsEl[currentButton.name].removeClass("jika-widgets-current"),currentButton.removeCurrentPlanTag(),delete currentButton.removeCurrentPlanTag,currentButton=e;const a=document.createElement("div");a.className="jika-widgets-plan-tag jika-widgets-plan-current-tag",a.textContent="Current",buttonsEl[currentButton.name].addClass("jika-widgets-current"),buttonsEl[currentButton.name].append(a),currentButton.removeCurrentPlanTag=()=>jQuery(".jika-widgets-plan-current-tag").remove(),ajaxPost("jika_widgets_after_paypal_subscription",{plan:t.plan,token:t.token},(function(){buttons.forEach((e=>{e.name!==t.plan?buttonsEl[e.name].removeClass("jika-widgets-current"):buttonsEl[e.name].addClass("jika-widgets-current")})),paypalButtons.close()}))}))}))})),jQuery(".jika_widgets_paypal_buttons").append(paypalButtons.element));planInputEl.attr("value",e.name)}))}));let initialDomain=jQuery("#domain").val();jQuery("#domain").change((function(e){const t=e.target.closest("form");if(!["signup","contact"].includes(t.querySelector("#auth_submit")?.name)){const{value:a}=e.target;if(a!==initialDomain){jQuery(".jika-widgets-update-domain-button").remove();const n=createButton({className:"jika-widgets-update-domain-button",textContent:"Update Domain"});e.target.parentElement.appendChild(n),n.addEventListener("click",(function(){handleUpdateDomain(a).then((e=>{ajaxPost("jika_widgets_update_domain",{domain:e.domains[0],token:e.token},(()=>{createSuccessNotice(t,"Successfully update domain"),jQuery(".jika-widgets-update-domain-button").remove(),initialDomain=a}))}))}))}else jQuery(".jika-widgets-update-domain-button").remove()}})),jQuery("#trademark-alias").click((function(){jQuery("#trademark").click()})),jQuery("#trademark").change((function(e){jQuery("#trademark-alias").addClass("hidden"),jQuery(".jika_widgets_trademark .jika_widgets_trademark_preview").remove(),jQuery(".jika-widgets-upload-trademark-button").remove();const[t]=e.target.files,a=createButton({className:"jika-widgets-upload-trademark-button",textContent:"Upload Trademark"});a.addEventListener("click",(function(){jQuery(".jika_widgets_trademark").addClass("jika_widgets_loading");const a=document.createElement("div");a.className="jika-widgets-spinner",jQuery(".jika_widgets_trademark").append(a),handleUploadTrademark(t).then((t=>{ajaxPost("jika_widgets_update_trademark",{trademark:t.trademark,token:t.token},(()=>{jQuery("#trademark-alias").removeClass("hidden"),jQuery(".jika-widgets-upload-trademark-button").remove(),jQuery(".jika_widgets_trademark .jika_widgets_trademark_preview").remove();const a=document.createElement("img");a.className="jika_widgets_trademark_preview",a.src=t.trademark,a.alt="",a.height=35,a.width=35,jQuery(".jika_widgets_trademark").prepend(a),jQuery(".jika_widgets_trademark .jika-widgets-spinner").remove(),jQuery(".jika_widgets_trademark").removeClass("jika_widgets_loading"),jQuery(".jika_widgets_trademark input").val(""),createSuccessNotice(e.target.closest("form"),"Successfully update trademark")}))}))}));const n=document.createElement("img");n.className="jika_widgets_trademark_preview",n.src=URL.createObjectURL(t),n.alt="",n.height=35,n.width=35,jQuery(".jika_widgets_trademark").prepend(n,a)})),jQuery("#auth_toggle").click((async e=>{const t={};"login"===e.target.name?t.auth_type="login":t.auth_type="signup",ajaxPost("jika_widgets_auth_toggle",t,(function(){e.target.closest("form").submit()}))}));const passwordRequirements=[["8 characters long",e=>e.length>7],["Upper-case letter",e=>/[A-Z]/.test(e)],["Lower-case letter",e=>/[a-z]/.test(e)],["Number",e=>/[0-9]/.test(e)]],passwordRequirementsElements=[];passwordRequirements.forEach((([e])=>{const t=document.createElement("p");t.className="password-requirement",t.textContent=e,passwordRequirementsElements.push(t)})),jQuery('input[name="jika_widgets_options[jika_widgets_password]"]').change((e=>{jQuery("p.password-requirement").remove();const{pattern:t,value:a}=e.target;t&&a&&passwordRequirements.some((([,e],t)=>e(a)?(passwordRequirementsElements[t].style.color="green",!1):(passwordRequirementsElements[t].style.color="red",!0)))&&jQuery('input[name="jika_widgets_options[jika_widgets_password]"]').after(passwordRequirementsElements)}));const getFormValues=(e,...t)=>t.map((t=>e[`jika_widgets_options[jika_widgets_${t}]`].value));jQuery("#auth_submit").click((async function(e){let t;const a=e.target.closest("form"),{name:n}=e.target;if(a.reportValidity()){if("signup"===n){const[e,n,r]=getFormValues(a,"email","password","domain");t=signup(e,n,r)}if("login"===n){const[e,n]=getFormValues(a,"email","password");t=login(e,n)}if("contact"===n){const[e,n,r,s,o]=getFormValues(a,"email","domain","company-profile","request-type","note");t=contactUs(e,n,r,s,o)}}if(t){a.classList.add("hidden");const e=document.createElement("div");e.className="jika-widgets-spinner",a.parentElement.append(e),await t.then((t=>{const r={};Object.entries(t).forEach((([e,t])=>{"domains"===e&&(e="domain",[t]=t),r[e]=t})),"contact"===n?(a.reset(),a.classList.remove("hidden"),a.parentElement.removeChild(e),createSuccessNotice(a,t.message)):ajaxPost("jika_widgets_auth_submit",r,(function(){a.submit()}))})).catch((t=>{a.classList.remove("hidden"),a.parentElement.removeChild(e);let n="Something went wrong, please check your input and try again";401===t.status?n="Wrong email or password":409===t.status?n="Email already in use":400===t.status&&(n=t.message),jQuery("#auth_error").text(n)}))}})),jQuery((()=>{document.body.style.setProperty("--usage",jQuery('input[name="jika_widgets_options[jika_widgets_usage]"]').data("usage"))}));