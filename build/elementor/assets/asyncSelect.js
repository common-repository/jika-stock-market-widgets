const{useState,useCallback,useRef,useEffect}=React,{createElement:wpCreateElement}=wp.element,{Dropdown,SearchControl}=wp.components,useDebounceWithCancel=(e,t=300)=>{const[n,a]=useState();return[useCallback(((...s)=>{clearTimeout(n),a(setTimeout((()=>{e.apply(this,s)}),t))}),[n,e,t]),useCallback((()=>{clearTimeout(n)}),[n])]};function AsyncSelect(e){const{onChange:t,loadOptions:n,isMulti:a,defaultValue:s,defaultOptions:l="No options",placeholder:o="Search"}=e,r=useRef(),i=useRef(),[c,u]=useState({}),[m,p]=useState(!1),[d,y]=useState(s),[h,w]=useState([]),[C,g]=useState(!1),[f,k]=useState("Loading"),[b,S]=useState(""),[E,v]=useDebounceWithCancel((e=>new Promise((t=>{if(c[e])t(c[e]);else{const a=n(e);a instanceof Promise?a.then((n=>{u((t=>({...t,[e]:n}))),t(n)})):(u((t=>({...t,[e]:a}))),t(a))}})).then(w).then((()=>{g(!1)})))),A=useCallback((e=>{v(),S(e),e?(g(!0),E(e)):(g(!1),w([]))}),[v,E]),j=useCallback((({isOpen:e,onToggle:n})=>wpCreateElement("div",{className:"jika-widgets-async-select"+(a?" jika-widgets-async-select-multi":""),onClick:e=>{if(e.target.name?.includes("remove-option")){const n=e.target.name.replace("remove-option-",""),a=d.filter((e=>e!==n));y(a),t(a)}else i.current.focus()},onFocus:()=>{i.current.focus()}},[!b&&d?wpCreateElement("div",{ref:r,className:"jika-widgets-async-select-selected"},[a?wpCreateElement(React.Fragment,{children:[d.map((e=>wpCreateElement("div",{key:e,className:"jika-widgets-async-select-selected-item"},[wpCreateElement("div",{},e),wpCreateElement("button",{type:"button",name:`remove-option-${e}`},"x")]))),wpCreateElement("button",{type:"button"},"+")]}):d]):null,wpCreateElement(SearchControl,{ref:i,value:b,onChange:t=>{A(t),(e&&!t||!e&&t)&&n()},placeholder:d?"":o,onBlur:e=>{["components-popover","jika-widgets-async-select-option"].some((t=>e.relatedTarget?.className.includes(t)))||p(!1)},onFocus:()=>{p(!0)}})])),[b,d,a,o,A]),R=useCallback((()=>{let e;return e=C?f:0===h.length?b?"No options":l:h,Array.isArray(e)&&(e=e.reduce(((e,t)=>Array.isArray(t.options)?[...e,{...t,options:t.options.filter((e=>Array.isArray(d)?!d.find((t=>t===e.key)):d!==e.key))}]:Array.isArray(d)?d.find((e=>e===t.key))?e:[...e,t]:d!==t.key?[...e,t]:e),[]).map((e=>Array.isArray(e.options)?wpCreateElement(React.Fragment,{key:e.label,children:[wpCreateElement("h4",{},e.label),e.options.map((e=>wpCreateElement("button",{key:e.key,type:"button",className:"jika-widgets-async-select-option",onClick:()=>{let n;S(""),a?(n=d?[...new Set([...d,e.key])]:[e.key],y(n),t(n)):(y(e.name),t(e)),p(!1)}},e.name)))]}):wpCreateElement("button",{key:e.key,type:"button",className:"jika-widgets-async-select-option",onClick:()=>{let n;S(""),a?(n=d?[...new Set([...d,e.key])]:[e.key],y(n),t(n)):(y(e.name),t(e)),p(!1)}},e.name)))),wpCreateElement("div",{className:"jika-widgets-async-select-options"},e)}),[C,f,h,b,d]);return useEffect((()=>{let e;return C?e=setInterval((()=>{k((e=>{let t=e.replace("Loading","");return 3===t.length?t="":t+=".",`Loading${t}`}))}),500):(clearInterval(e),k("Loading")),()=>{clearInterval(e)}}),[C]),useEffect((()=>{i.current&&r.current&&(i.current.style.height=`${r.current.offsetHeight+20}px`)}),[d]),wpCreateElement(Dropdown,{open:m,setOpen:p,renderToggle:j,renderContent:R})}const baseUrl="https://www.jika.io/api",handleFetch=(e,t)=>fetch(`${baseUrl}${e}`,t).then((e=>e.json()));function handleRegisterAsyncSelect(e,t,n){const a=elementor.modules.controls[n].extend({onReady(){this.initialValue=this.options.elementSettingsModel.attributes[this.model.attributes.name],this.newValue=this.initialValue;const t=this,n=`.elementor-control-async-select.${my_elementor_obj.control_uid.replace("{{{ data._cid }}}",this.model.cid)}`;waitForElement(n).then((()=>{ReactDOM.render(wpCreateElement(AsyncSelect,{...e,onChange:n=>e.onChange(t,n),defaultValue:t.initialValue}),document.querySelector(n))}))},saveValue(){this.setValue(this.newValue)},onBeforeDestroy(){this.options.elementSettingsModel.attributes[this.model.attributes.name]=this.newValue}});elementor.addControlView(t,a)}function registerAsyncSelect(e,t,n="BaseData"){const a=()=>handleRegisterAsyncSelect(e,t,n);window.elementor?a():window.addEventListener("elementor/init",a)}